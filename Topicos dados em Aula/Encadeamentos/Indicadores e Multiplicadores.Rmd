---
title: "Indicadores de Encadeamentos e Multiplicadores"
author: "Felipe Cornelio e Marcelo Tonon"
date: "16/08/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# 1. Introdução

Nesse material iremos apresentar diversos indicadores de encadeamentos para a economia, conforme a literatura apresentada no curso. Além dos impactos sobre os dados originais da matriz, incluiremos também o efeito induzido sobre o consumo das famílias. 

O primeiro passo é a leitura dos dados, para os quais usaremos a matriz ao nível de 67 setores divulgado para o IBGE para o ano de 2015. Vale destacar que os exercícios aqui eleborados podem ser facilmente aplicados tambéms para as matrizes estimadas para os demais anos.

## Leitura dos Dados

```{r}

# Pacotes
library(readxl)
library(purrr)
```


```{r, warning=F}

# Dados

MIP_2015 <- "Matriz_de_Insumo_Produto_2015_Nivel_67.xls"

# Vetores com os nomes das atividades e dos produtos
nomes_produtos <- read_xls(MIP_2015, sheet='01', range='B6:B132',col_names = 'Prod_nome') %>% as.character()
nomes_atividades <- read_xls(MIP_2015, sheet='13', range='B6:B72',col_names = 'Ativ_nome') %>% t() %>% as.character()

# Informações
An <- read_xls(MIP_2015, sheet = '14', range='c6:bq72', col_names = nomes_atividades)
L <-  read_xls(MIP_2015, sheet = '15', range='c6:bq72', col_names = nomes_atividades)
DF_127 <- read_xls(MIP_2015, sheet = '03', range='r6:w132',col_names = F)
MS <- read_xls(MIP_2015, sheet = '13', range='c6:dy72', col_names = F)

# VA TRU 2015
TRU_2015 <- read_xls("68_tab2_2015.xls", sheet='VA', range='B4:BQ19') %>% as.data.frame() %>% na.omit()
Comercio <- TRU_2015[,42]+TRU_2015[,43]
TRU_2015[,42] <- Comercio
TRU_2015[,43] <- NULL

```

# 2. Endogeneizando o Consumo

Vamos aqui criar a matriz de coeficientes do consumo, confome realizado em Freitas e Dweck (2010) e inspirado em Myiazawa (1976). Vamos aqui para simplificar a análise e também apresentar uma situação semelhante à encontrada em Miller e Blair (????), na qual todo o consumo das famílias é assumido como endógeno^[Na versão de Freitas e Dweck (2010) e também Cornelio(2017), há a separação do consumo das famílias em um componente exógeno (consumo de duráveis) e outro endógenos (consumo de não-duráveis). No caso, somente o consumo de não duráveis é usado no procedimento de fechamento do modelo para o consumo.]

```{r}

# coeficientes técnicos referentes a produçao das famílias

hr <- TRU_2015[3,]/TRU_2015[13,]

# coeficientes referentes ao consumo das famílias

hc <- t(DF_127[,4])/(rep(rowSums(TRU_2015[3,]),127))


#matriz de coeficientes técnicos de consumo

Bcon <- t(as.matrix(hc))%*%as.matrix(hr)

#matriz de coeficientes técnicos de consumo intersetoriais

Acon <- as.matrix(MS)%*%Bcon

# matriz de coeficientes técnicos intersetoriais completa

An_total <- An+Acon

# Inversa de leontief com Consumo Induzido

L_total <- solve(diag(1,67,67)-An_total)
```


# 3. Indicadores de Encadeamento para Trás e para Frente

## 3.1 Efeitos Diretos

O primeiro indicador é o apresentado por Chenery e Watanabe (1958)

```{r}
C_W_BL <- colSums(An)
```


```{r}
C_W_FL <- rowSums(An)
```


## 3.2 Efeitos Diretos e Indiretos

```{r}
BL <- as.data.frame(colSums(L))
names(BL) <- 'Backward Linkages'
```

```{r}
FL <- as.data.frame(rowSums(L))
names(FL) <- 'Forward Linkages'
```

```{r}
BL_ind <- BL - C_W_BL
```

```{r}
FL_ind <- FL - C_W_FL
```

## 3.3 Efeitos Diretos, Indireto e Induzidos

```{r}
BL_tot <- as.data.frame(colSums(L_total))
names(BL_tot) <- 'Backward Linkages Total'
```

```{r}
FL_tot <- as.data.frame(rowSums(L_total))
names(FL_tot) <- 'Forward Linkages Total'
```

## 3.4 Síntese dos Resultados


# 4. Indicadores Normalizados


```{r, eval=F}
# Indicadores de Poder e Sensibilidade de Dispersão - matriz simples

BL_medio <- BL/67
FL_medio <- FL/67
M_tot <- as.data.frame(sum(L)/(67^2))
M_tot_aux <- rep.row(as.matrix(M_tot),67)

pd <- BL_medio/M_tot_aux
sd <- FL_medio/M_tot_aux


# Indicadores de Poder e Sensibilidade de Dispersão - matriz induzida

BL_tot_medio <- BL_tot/67
FL_tot_medio <- FL_tot/67
M_ind_tot <- as.data.frame(sum(L_total)/(67^2))
M_ind_tot_aux <- rep.row(as.matrix(M_ind_tot),67)

pd_tot <- BL_tot_medio/M_ind_tot_aux
sd_tot <- FL_tot_medio/M_ind_tot_aux
```



## 4.1 Poder de Dispersão

## 4.2 Sensibilidade de Dispersão




# 5. Outros métodos


