---
title: "Indicadores de Encadeamentos e Multiplicadores"
author: "Felipe Cornelio e Marcelo Tonon"
date: "16/08/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# 1. Introdução

Nesse material iremos apresentar diversos indicadores de encadeamentos para a economia, conforme a literatura apresentada no curso. Além dos impactos sobre os dados originais da matriz, incluiremos também o efeito induzido sobre o consumo das famílias. 

O primeiro passo é a leitura dos dados, para os quais usaremos a matriz ao nível de 67 setores divulgado para o IBGE para o ano de 2015. Vale destacar que os exercícios aqui eleborados podem ser facilmente aplicados tambéms para as matrizes estimadas para os demais anos.

## Leitura dos Dados


```{r, warning=F, }
# Pacotes
library(readxl)
library(purrr)
library(formattable)
```

Antes da leitura dos dados, mostraremos novamente a forma de fazer o download automático da matriz. Caso já tenha o arquivo no diretório e não queira refazer o download, é necessário apenas fazer a leitura do comando para o nome do arquivo:

```{r download}
#download.file("ftp://ftp.ibge.gov.br/Contas_Nacionais/Matriz_de_Insumo_Produto/2015/Matriz_de_Insumo_Produto_2015_Nivel_67.xls", destfile = "Matriz_de_Insumo_Produto_2015_Nivel_67.xls", mode = "wb")

MIP_2015 <- "Matriz_de_Insumo_Produto_2015_Nivel_67.xls"
```

Realizando agora leitura dos dados obtidos diretamente da matriz de insumo-produto do IBGE:

```{r, warning=F}

# Vetores com os nomes das atividades e dos produtos
nomes_produtos <- read_xls(MIP_2015, sheet='01', range='B6:B132',col_names = 'Prod_nome') %>% t() %>% as.character()
nomes_atividades <- read_xls(MIP_2015, sheet='13', range='B6:B72',col_names = 'Ativ_nome') %>% t() %>% as.character()

# Informações da MIP
An <- read_xls(MIP_2015, sheet = '14', range='c6:bq72', col_names = nomes_atividades)
L <-  read_xls(MIP_2015, sheet = '15', range='c6:bq72', col_names = nomes_atividades)
DF_127 <- read_xls(MIP_2015, sheet = '03', range='BT4:BY132') %>% na.omit()
MS <- read_xls(MIP_2015, sheet = '13', range='c6:dy72', col_names = nomes_produtos)
x <- as.matrix(t(read_xls(MIP_2015, sheet='01', range='H134:BV134', col_names = nomes_atividades)))

```

Além da MIP são necessárias informações da Tabela de Recursos e Usos para realizar todas as tarefas que serão apresentadas aqui. A obtenção de forma automatizada dessa parte envolveria um conhecimento que será discutido no tópico 5 das monitorias, mas ainda não apresentado.^[As TRUs são disponibilizadas pelo IBGE em um arquivo compactado (.zip ou .rar) com diversos arquivos contidos, em que necessitamos apenas das Tabelas 2, com as informações dos Usos a preços correntes.]

```{r,warning=FALSE}
# VA TRU 2015
nomes_va <- read_xls("68_tab2_2015.xls", sheet='VA', range='A6:A19',col_names = "TRU") %>% t() %>% as.character()
TRU_2015 <- read_xls("68_tab2_2015.xls", sheet='VA', range='B4:BQ19') %>% as.data.frame() %>% na.omit()
rownames(TRU_2015) <- nomes_va
# Soma do Comercio Varejo e Atacado
Comercio <- TRU_2015[,42]+TRU_2015[,43]
TRU_2015[,42] <- Comercio
TRU_2015[,43] <- NULL
```

# 2. Indicadores de Encadeamento para Trás e para Frente

A partir desses dados podemos extrair informações relevantes acerca das relações intersetoriais e os setores com maiores impactos. Em primeiro lugar, podemos extrair os indicadores de encadeamento para trás (backward linkages - bl), que indicam o impacto de uma variação na demanda final de um dado setor sobre os demais setores da economia (via demanda intermediária); e encadeamentos para frente (forward linkages - fl), indicando o quanto uma atividade é sensível a variações das demais atividades. 


## 2.1 Efeitos Diretos

O primeiro indicador é o apresentado por Chenery e Watanabe (1958), que capta os impactos diretos de um setor, sem levar em conta a difusão que esse impacto pode ter para outros setores que não estão diretamente ligados ao setor na cadeia. Ele é calculado pela soma nas colunas da matriz de coeficientes técnicos (An) em sua versão de encadeamentos para trás ($b$) e pela soma das linhas para avaliar os encadeamentos para frente ($f$). Matricialmente teríamos:
$$ b=i'A_n$$
$$f=A_ni$$
Isso poderia ser calculado no R da seguinte forma:

```{r}

# Encadeamentos diretos para trás
b <- colSums(An)

# Encadeamentos diretos para frente
f <- rowSums(An)
```


## 2.2 Efeitos Diretos e Indiretos

Mais precisamente, os encadeamentos para trás seriam obtidos pela soma dos componentes de cada coluna da matriz de impacto, enquanto os encadeamentos para frente obtidos pela soma de cada linha da matriz de impacto. Usando a notação de Miller e Blair (2009), temos que a matriz de impacto é tal que:
$$L=(I-A_n)^{-1}$$
Esta versão de indicador de encadeamentos para trás e de encadeamentos para frente é baseado em Rasmussen (1957), e seria capaz de captar tanto os efeitos diretos, quanto os efeitos indiretos - i.e. os efeitos sobre a cadeia produtiva dos setores que foram impactados diretamente na cadeia produtiva do setor estimulado. No caso, teríamos os 
backward linkages 
$$bl=i'L$$
$$fl=Li$$		
Onde i é um vetor de soma composto por números 1 e Z é uma matriz de impacto arbitrária. 

```{r}
bl <- as.data.frame(colSums(L))
names(bl) <- 'Backward Linkages'
```

```{r}
fl <- as.data.frame(rowSums(L))
names(fl) <- 'Forward Linkages'
```

Se quisermos isolar os efeitos indiretos, basta realizar a substração entre os indicadores com efeitos diretos e indiretos ($bl$ e $fl$) e o que capta somente o efeito direto ($b$ e $f$):

```{r}
bl_ind <- bl - b
```

```{r}
fl_ind <- fl - f
```


## 2.3 Síntese dos Resultados

Vamos agora reunir os resultados para os dois tipos de indicadores apresentados: i) Diretos e ii) Diretos + Indiretos.

```{r}
sintese <- data.frame(b,bl,f,fl)
names(sintese) <- c("b", "bl","f","fl")
```

Vamos então visualizar os resultados e quais são os setores-chave da economia de acordo com cada indicador:

```{r}

formattable(sintese, list(
  b = formatter("span", style = x ~ style(color = ifelse(rank(-x) <= 5, "green", "gray")), x ~ sprintf("%.2f (rank: %02g)", x, rank(-x))), 
  bl = formatter("span", style = x ~ style(color = ifelse(rank(-x) <= 5, "green", "gray")), x ~ sprintf("%.2f (rank: %02g)", x, rank(-x))),
  f = formatter("span", style = x ~ style(color = ifelse(rank(-x) <= 5, "green", "gray")), x ~ sprintf("%.2f (rank: %02g)", x, rank(-x))), 
  fl = formatter("span", style = x ~ style(color = ifelse(rank(-x) <= 5, "green", "gray")), x ~ sprintf("%.2f (rank: %02g)", x, rank(-x)))))

```

# 3. Indicadores Normalizados

Conforme Nassif, Teixeira e Rocha (2015), Freitas e Dweck (2010) e Miller e Blair (2009), uma melhor forma de entender quão relevante é um setor para a economia é calcular os índices de poder de dispersão e sensibilidade de dispersão. Mas antes disso, necessita-se de duas medidas que indicam o impacto e a sensibilidade média de cada atividade. O primeiro são os backward e forward linkages médios, ou seja, os componentes do vetor bl e fl divididos pelo escalar (m) representando o número total de atividades (soma do número de atividades/setores:
$$\bar{bl}=bl(1/m)$$
$$\bar{fl}=fl(1/m)$$
A segunda medida necessária é a média total dos coeficientes da matriz de impacto, de forma a normalizar os encadeamentos médios. Os valores são obtidos mediante a soma de todos os coeficientes da Matriz de Impacto, divididos pelo número de atividades ao quadrado:
$$M_{tot}=i'Li(1/m^2)$$		
Em posse de ambas as medidas, os indicadores de poder de dispersão (pd) sensibilidade de dispersão (sd) de forma que:
$$pd=\bar{bl}/M_{tot}$$
$$sd=\bar{fl}/M_{tot}$$
Trata-se de uma medida normalizada de impacto, de forma a avaliar comparativamente os setores, e não para se obter uma medida absoluta de impacto. Para o poder de dispersão, valores maiores do que a unidade (bl>1) representam setores chave que apresentam impacto sobre os demais setores superior ao impacto médio total e vice-versa. Já para a sensibilidade de dispersão, valores maiores que a unidade (sd>1) representam setores que respondem a variações em outros setores em uma magnitude maior que a média da economia, e vice-versa.

No R, estes indicadores são facilmente obtidos:
```{r}
# Indicadores de Poder e Sensibilidade de Dispersão

bl_medio <- bl/67
fl_medio <- fl/67
M_tot <- as.data.frame(sum(L)/(67^2))

pd <- bl_medio/as.numeric(M_tot)
sd <- fl_medio/as.numeric(M_tot)

```

Criando uma tabela reunindo os valores e ordenando os setores:

```{r}
#reunindo os dados
sintese_norm <- data.frame(pd,sd)
names(sintese_norm) <- c("pd", "sd")

# Gerando a tabela
formattable(sintese_norm, list(
  pd = formatter("span", style = x ~ style(color = ifelse(rank(-x) <= 5, "green", "gray")), x ~ sprintf("%.2f (rank: %02g)", x, rank(-x))), 
  sd = formatter("span", style = x ~ style(color = ifelse(rank(-x) <= 5, "green", "gray")), x ~ sprintf("%.2f (rank: %02g)", x, rank(-x)))))

```


# 4. Outros métodos

# 5. Referências

